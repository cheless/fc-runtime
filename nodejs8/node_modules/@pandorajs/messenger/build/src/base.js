'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const Base = require("sdk-base");
const assert = require("assert");
const eventName_1 = require("./eventName");
const os = require("os");
const path = require("path");
const tmpDir = process.env.PANDORA_TMP_DIR || os.tmpdir();
const sockPath = Symbol('sockpath');
class MessengerBase extends Base {
    constructor(options) {
        super();
        if (!options.socket) {
            assert(options.name, 'options.name is required!');
        }
        this.options = options;
        this.on(eventName_1.default, (message, reply, client) => {
            if (message && typeof message.action === 'string') {
                this.emit(message.action, message.data, reply, client);
            }
        });
    }
    _throwError(error) {
        this.emit('error', error);
    }
    defaultErrorHandler(err) {
        // pass
    }
    get sockPath() {
        if (!this[sockPath]) {
            let sock = path.join(tmpDir, `pandorajs_${this.options.name.replace(/[^\w]/g, '')}.sock`);
            if (process.platform === 'win32') {
                sock = '\\\\.\\pipe\\' + sock.replace(/^\//, '').replace(/\//g, '-');
            }
            this[sockPath] = sock;
        }
        return this[sockPath];
    }
}
exports.default = MessengerBase;
//# sourceMappingURL=base.js.map